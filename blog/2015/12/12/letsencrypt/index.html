<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Let's encrypt | Au coin d'une table</title><meta name=keywords content="ssl,letsencrypt"><meta name=description content="Avoir un site HTTP, c’est has been. Maintenant, il faut que tout soit en HTTPS. Oui, mais voilà, jusqu’à récemment, c’était payant ! Heureusement, avec Let’s Encrypt, c’est maintenant possible d’avoir un certificat SSL gratuitement.
 J’ai reçu mon mail d’acceptation à l’open beta il n’y a pas si longtemps, et du coup, j’en profite pour passer mes sites persos en HTTPS.
 Pour rappel, je suis sur Ubuntu 15.10, j’utilise nginx comme serveur web et j’ai déjà git d’installé."><meta name=author content="Isammoc"><link rel=canonical href=https://blog.isammoc.net/blog/2015/12/12/letsencrypt/><link href=/assets/css/stylesheet.min.0ef71315edca03ac3fb4b85c2eaba80d9aa9c097f62b53e704ebe8e433907e89.css integrity="sha256-DvcTFe3KA6w/tLhcLquoDZqpwJf2K1PnBOvo5DOQfok=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.isammoc.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.isammoc.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.isammoc.net/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.isammoc.net/apple-touch-icon.png><link rel=mask-icon href=https://blog.isammoc.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.80.0"><meta property="og:title" content="Let's encrypt"><meta property="og:description" content="Avoir un site HTTP, c’est has been. Maintenant, il faut que tout soit en HTTPS. Oui, mais voilà, jusqu’à récemment, c’était payant ! Heureusement, avec Let’s Encrypt, c’est maintenant possible d’avoir un certificat SSL gratuitement.
 J’ai reçu mon mail d’acceptation à l’open beta il n’y a pas si longtemps, et du coup, j’en profite pour passer mes sites persos en HTTPS.
 Pour rappel, je suis sur Ubuntu 15.10, j’utilise nginx comme serveur web et j’ai déjà git d’installé."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.isammoc.net/blog/2015/12/12/letsencrypt/"><meta property="article:published_time" content="2015-12-12T00:00:00+00:00"><meta property="article:modified_time" content="2015-12-12T00:00:00+00:00"><meta property="og:site_name" content="Au coin d'une table"><meta name=twitter:card content="summary"><meta name=twitter:title content="Let's encrypt"><meta name=twitter:description content="Avoir un site HTTP, c’est has been. Maintenant, il faut que tout soit en HTTPS. Oui, mais voilà, jusqu’à récemment, c’était payant ! Heureusement, avec Let’s Encrypt, c’est maintenant possible d’avoir un certificat SSL gratuitement.
 J’ai reçu mon mail d’acceptation à l’open beta il n’y a pas si longtemps, et du coup, j’en profite pour passer mes sites persos en HTTPS.
 Pour rappel, je suis sur Ubuntu 15.10, j’utilise nginx comme serveur web et j’ai déjà git d’installé."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://blog.isammoc.net/blog/"},{"@type":"ListItem","position":2,"name":"Let's encrypt","item":"https://blog.isammoc.net/blog/2015/12/12/letsencrypt/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Let's encrypt","name":"Let\u0027s encrypt","description":"Avoir un site HTTP, c’est has been. Maintenant, il faut que tout soit en HTTPS. Oui, mais voilà, jusqu’à récemment, c’était payant ! Heureusement, avec Let’s Encrypt, c’est …","keywords":["ssl","letsencrypt"],"articleBody":"Avoir un site HTTP, c’est has been. Maintenant, il faut que tout soit en HTTPS. Oui, mais voilà, jusqu’à récemment, c’était payant ! Heureusement, avec Let’s Encrypt, c’est maintenant possible d’avoir un certificat SSL gratuitement.\n J’ai reçu mon mail d’acceptation à l’open beta il n’y a pas si longtemps, et du coup, j’en profite pour passer mes sites persos en HTTPS.\n Pour rappel, je suis sur Ubuntu 15.10, j’utilise nginx comme serveur web et j’ai déjà git d’installé.\n Installation Il faut simplement récupérer le dépôt par git :\n cd /opt sudo git clone https://github.com/letsencrypt/letsencrypt.git cd letsencrypt ./letsencrypt-auto --help   Cette dernière commande va lancer letsencrypt pour qu’il gère ses dépendances et affichera l’aide\n   Configuration Dans un fichier de configuration (exemple : /etc/letsencrypt/cfg.ini )\n # Rallonge la longueur de la clef RSA à 4096 bits rsa-key-size = 4096 # S'enregistre avec cette adresse (la même que pour la demande de beta) email = contact@mydomain.com # Accepte automatiquement les conditions d'utilisation agree-tos = True # Utilise une interface purement textuelle à la place de NCurse text = True # Utilisez une racine web comme authentifieur authenticator = webroot # Le chemin de la racine web webroot-path = /tmp/letsencrypt-auto     Nginx Pour que letsencrypt-auto puisse s’authentifier automatiquement, il faut que l’on surcharge la configuration de Nginx afin de bypasser certains chemins.\n Dans /etc/nginx/sites-available/monsite :\n server { listen 80; listen [::]:80; server_name monsite.fr; location '/.well-known/acme-challenge/' { root /tmp/letsencrypt-auto; } location / { return 301 https://my_domain.com$request_uri; } }   Tant qu’à faire, on fait en sorte de ne passer que par le HTTPS.\n Et on recharge la configuration de nginx :\n sudo service nginx reload     Premier certificat Faisons notre premier certificat manuellement :\n sudo mkdir -p /tmp/letsencrypt-auto sudo /opt/letsencrypt/letsencrypt-auto certonly --config /etc/letsencrypt/cfg.ini -d monsite.fr   Si tout va bien, vous apercevez maintenant un texte indicant la réussite et que votre nouveau certificat est à l’emplacement /etc/letsencrypt/live/monsite.fr/fullchain.pem.\n   Configuration le https sur nginx Retournons à la configuration du site nginx /etc/nginx/sites-available/monsite :\n server { listen 443 ssl; server_name monsite.fr; ssl_certificate /etc/letsencrypt/live/monsite.fr/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/monsite.fr/privkey.pem; location / { root /var/www/monsite; } }   Et recharchez la configuration :\n sudo service nginx reload     Automatiser le renouvellement des certificats Dans un fichier adéquat (ex : /usr/local/sbin/certrenew.sh)\n #!/bin/bash DOMAINS=\"-d monsite.fr\" DIR=/tmp/letsencrypt-auto mkdir -p $DIR \u0026\u0026 /opt/letsencrypt/letsencrypt-auto certonly --renew -c /etc/letsencrypt/cfg.ini $DOMAINS service nginx reload   N’oubliez pas de le rendre exécutable :\n sudo chmod a+x /usr/local/sbin/certrenew.sh   Et automatisez son exécution, en ouvrant un crontab :\n sudo crontab -e   et rajoutez une ligne :\n 0 0 1 1,3,5,7,9,11 1 bash /usr/local/sbin/certrenew.sh  /var/log/certrenew.log   Cela lancera le script tous les 1ers des mois impairs (janvier, mars, mai, etc.)\n   Références   Site officel : Let’s Encrypt\n  Article de blog : ramblings\n     ","wordCount":"439","inLanguage":"en","datePublished":"2015-12-12T00:00:00Z","dateModified":"2015-12-12T00:00:00Z","author":{"@type":"Person","name":"Isammoc"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.isammoc.net/blog/2015/12/12/letsencrypt/"},"publisher":{"@type":"Organization","name":"Au coin d'une table","logo":{"@type":"ImageObject","url":"https://blog.isammoc.net/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://blog.isammoc.net/ accesskey=h title="Au coin d'une table (Alt + H)"><img src=/apple-touch-icon.png alt=logo aria-label=logo height=35>Au coin d'une table</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://blog.isammoc.net/categories/ title=categories><span>categories</span></a></li><li><a href=https://blog.isammoc.net/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Let's encrypt</h1><div class=post-meta>December 12, 2015&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Isammoc</div></header><div class=post-content><div class=paragraph><p>Avoir un site HTTP, c’est has been. Maintenant, il faut que tout soit en HTTPS. Oui, mais voilà, jusqu’à récemment, c’était payant ! Heureusement, avec <a href=https://letsencrypt.org/>Let’s Encrypt</a>, c’est maintenant possible d’avoir un certificat SSL gratuitement.</p></div><div class=paragraph><p>J’ai reçu mon mail d’acceptation à l’open beta il n’y a pas si longtemps, et du coup, j’en profite pour passer mes sites persos en HTTPS.</p></div><div class=paragraph><p>Pour rappel, je suis sur <code>Ubuntu 15.10</code>, j’utilise <code>nginx</code> comme serveur web et j’ai déjà <code>git</code> d’installé.</p></div><div class=sect1><h2 id=_installation>Installation<a hidden class=anchor aria-hidden=true href=#_installation>#</a></h2><div class=sectionbody><div class=paragraph><p>Il faut simplement récupérer le dépôt par git :</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>cd /opt
sudo git clone https://github.com/letsencrypt/letsencrypt.git
cd letsencrypt
./letsencrypt-auto --help</code></pre></div></div><div class=paragraph><p>Cette dernière commande va lancer <code>letsencrypt</code> pour qu’il gère ses dépendances et affichera l’aide</p></div></div></div><div class=sect1><h2 id=_configuration>Configuration<a hidden class=anchor aria-hidden=true href=#_configuration>#</a></h2><div class=sectionbody><div class=paragraph><p>Dans un fichier de configuration (exemple : <code>/etc/letsencrypt/cfg.ini</code> )</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-ini data-lang=ini># Rallonge la longueur de la clef RSA à 4096 bits
rsa-key-size = 4096

# S&#39;enregistre avec cette adresse (la même que pour la demande de beta)
email = contact@mydomain.com
# Accepte automatiquement les conditions d&#39;utilisation
agree-tos = True

# Utilise une interface purement textuelle à la place de NCurse
text = True

# Utilisez une racine web comme authentifieur
authenticator = webroot
# Le chemin de la racine web
webroot-path = /tmp/letsencrypt-auto</code></pre></div></div></div></div><div class=sect1><h2 id=_nginx>Nginx<a hidden class=anchor aria-hidden=true href=#_nginx>#</a></h2><div class=sectionbody><div class=paragraph><p>Pour que <code>letsencrypt-auto</code> puisse s’authentifier automatiquement, il faut que l’on surcharge la configuration de Nginx afin de bypasser certains chemins.</p></div><div class=paragraph><p>Dans <code>/etc/nginx/sites-available/monsite</code> :</p></div><div class=listingblock><div class=content><pre>server {
  listen 80;
  listen [::]:80;
  server_name monsite.fr;

  location &#39;/.well-known/acme-challenge/&#39; {
    root /tmp/letsencrypt-auto;
  }

  location / {
    return 301 https://my_domain.com$request_uri;
  }
}</pre></div></div><div class=paragraph><p>Tant qu’à faire, on fait en sorte de ne passer que par le HTTPS.</p></div><div class=paragraph><p>Et on recharge la configuration de nginx :</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>sudo service nginx reload</code></pre></div></div></div></div><div class=sect1><h2 id=_premier_certificat>Premier certificat<a hidden class=anchor aria-hidden=true href=#_premier_certificat>#</a></h2><div class=sectionbody><div class=paragraph><p>Faisons notre premier certificat manuellement :</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>sudo mkdir -p /tmp/letsencrypt-auto
sudo /opt/letsencrypt/letsencrypt-auto certonly --config /etc/letsencrypt/cfg.ini -d monsite.fr</code></pre></div></div><div class=paragraph><p>Si tout va bien, vous apercevez maintenant un texte indicant la réussite et que votre nouveau certificat est à l’emplacement <code>/etc/letsencrypt/live/monsite.fr/fullchain.pem</code>.</p></div></div></div><div class=sect1><h2 id=_configuration_le_https_sur_nginx>Configuration le https sur nginx<a hidden class=anchor aria-hidden=true href=#_configuration_le_https_sur_nginx>#</a></h2><div class=sectionbody><div class=paragraph><p>Retournons à la configuration du site nginx <code>/etc/nginx/sites-available/monsite</code> :</p></div><div class=listingblock><div class=content><pre class=highlight><code>server {
  listen 443 ssl;
  server_name monsite.fr;

  ssl_certificate        /etc/letsencrypt/live/monsite.fr/fullchain.pem;
  ssl_certificate_key    /etc/letsencrypt/live/monsite.fr/privkey.pem;

  location / {
    root /var/www/monsite;
  }
}</code></pre></div></div><div class=paragraph><p>Et recharchez la configuration :</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>sudo service nginx reload</code></pre></div></div></div></div><div class=sect1><h2 id=_automatiser_le_renouvellement_des_certificats>Automatiser le renouvellement des certificats<a hidden class=anchor aria-hidden=true href=#_automatiser_le_renouvellement_des_certificats>#</a></h2><div class=sectionbody><div class=paragraph><p>Dans un fichier adéquat (ex : <code>/usr/local/sbin/certrenew.sh</code>)</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>#!/bin/bash
DOMAINS=&#34;-d monsite.fr&#34;
DIR=/tmp/letsencrypt-auto
mkdir -p $DIR &amp;&amp; /opt/letsencrypt/letsencrypt-auto certonly --renew -c /etc/letsencrypt/cfg.ini $DOMAINS
service nginx reload</code></pre></div></div><div class=paragraph><p>N’oubliez pas de le rendre exécutable :</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>sudo chmod a+x /usr/local/sbin/certrenew.sh</code></pre></div></div><div class=paragraph><p>Et automatisez son exécution, en ouvrant un crontab :</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>sudo crontab -e</code></pre></div></div><div class=paragraph><p>et rajoutez une ligne :</p></div><div class=listingblock><div class=content><pre class=highlight><code>0 0 1 1,3,5,7,9,11 1 bash /usr/local/sbin/certrenew.sh &gt;&gt; /var/log/certrenew.log</code></pre></div></div><div class=paragraph><p>Cela lancera le script tous les 1ers des mois impairs (janvier, mars, mai, etc.)</p></div></div></div><div class=sect1><h2 id=_références>Références<a hidden class=anchor aria-hidden=true href=#_références>#</a></h2><div class=sectionbody><div class=ulist><ul><li><p>Site officel : <a href=https://letsencrypt.org/>Let’s Encrypt</a></p></li><li><p>Article de blog : <a href=https://overflow.no/blog/2015/12/04/fully-automated-https-with-certificates-from-lets-encrypt/>ramblings</a></p></li></ul></div></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.isammoc.net/tags/ssl/>ssl</a></li><li><a href=https://blog.isammoc.net/tags/letsencrypt/>letsencrypt</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://blog.isammoc.net/>Au coin d'une table</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/assets/js/highlight.min.b5c50a006af5240e8b9a820c9517fc939c995c2503cb822fca9c6177c10b9926.js integrity="sha256-tcUKAGr1JA6LmoIMlRf8k5yZXCUDy4Ivypxhd8ELmSY=" onload=hljs.initHighlightingOnLoad();></script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>